### 网络模型

#### OSI七层模型

* 物理层
* 数据链路层
* 网络层
* 传输层
* 会话层
* 表示层
* 应用层

#### TCP/IP五层模型

* 物理层
* 数据链路层
* 网络层
  * IP
* 传输层
  * TCP
  * UDP
* 应用层
  * HTTP
  * MQTT
  * FTP
  * XMPP
  * RTP
  * WEBRTC

##### 传输层协议

|          |            TCP             |                  UDP                   |
| :------: | :------------------------: | :------------------------------------: |
|   连接   |          面向连接          |                 无连接                 |
|  可靠性  |            可靠            |                 不可靠                 |
| 连接个数 |           一对一           |         一对一、一对多、多对多         |
| 传输方式 |         面向字节流         |                面向报文                |
| 首部开销 | 首部最小20字节，最大60字节 |          首部开销小，仅8字节           |
| 适用场景 |     要求可靠传输的应用     | 适用实时应用，如IP电话、视频会议、直播 |
|          |          拥塞控制          |                                        |

###### TCP

* 缺点
  * 弱网环境丢包

    > 拥塞控制认为网络传输饱和，从而采取指数级避让。

  * 队头阻塞

    > 一旦没有收到某个节点的包，后面的内容都需要等待。

  * SYN洪泛攻击

    > 1. 无效连接监控释放。
    > 2. 防火墙。
    > 3. TCB(连接控制资源)延迟分配。

* 三次握手
  * client ：SYN = 1,seq = n(随机数)
  * sever ：ACK = 1,ack = n+1；SYN = 1,seq = m(随机数)
  * client ：ACK = 1，ack = m+1
* 四次挥手
  * client : FIN = M 
  * sever : ACK = M+1
  * sever : FIN = N
  * client : ACK = N+1

###### Socket

> 对TCP、UDP的封装。

##### 应用层协议

###### 长连接

* BIO

  `一个连接一个线程。`

  > 面向流：
  >
  > 1. 每次只能读取一个或多个字节，没有缓存。
  > 2. 不能向前或向后移动，需要读取到缓存中，才能移动。
  > 3. 阻塞式。
  > 4. 流是单向的

* NIO

  `一个有效请求一个线程，客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询查到连接有IO请求时才启动一个线程处理。`

  > 面向缓冲

  * Selector

    * OP_READ
    * OP_WRITE
    * OP_CONNECT
    * OP_ACCEPT

  * Channel

    `双向通信。`

    * ServerSocketChannel
      * OP_ACCEPT
    * SocketChannel
      * Server
        * OP_READ
        * OP_WRITE
      * Client
        * OP_READ
        * OP_WRITE
        * OP_CONNECT

  * Buffer

    > 是一块可以读写的被包装成NIO Buffer的内存块。

    * HeapByteBuffer

      > flush时需要先复制到内存。

    * DirectByteBuffer

      > 1. 直接分配到内存。
      > 2. 不是虚拟机运行时数据区的一部分。
      > 3. 也不是虚拟机规范定义的内存区域。
      > 4. 可能造成OOM。

  * Reactor

  * JVM对多路复用的优化

    * select

      > 数组保存连接。
      >
      > 操作时，需要遍历，随着连接数的增多，性能下降严重。

    * poll

      > 链表保存连接。
      >
      > 需要内核将消息传递给用户空间，需要内核复制。

    * epoll

      > 哈希表。
      >
      > 内核实现根据FD上的回调函数，只有活跃的连接才会主动调用回调，所以连接活跃不多时，并没有性能问题。
      >
      > 通过内核与用户空间映射同一块内存，不需要复制。

* AIO

  `一个有效请求一个线程，客户端的 I/O 请求都是由 OS 先完成了再通知 服务器应用去启动线程进行处理。`

###### HTTP

* URI

  `统一资源标识符`

  > 1. 访问资源的命名机制。
  >
  > 2. 存放资源的主机名。
  >
  > 3. 资源自身的名称，由路径标识。

* URL

  `统一资源定位符，标识了一个资源，还标明了如何locate资源。`

  > 1. 协议。
  > 2. 存放资源的主机IP端口。
  > 3. 主机资源的具体地址，如目录和文件名。

* 请求方法

  |  方法   |                       说明                       |
  | :-----: | :----------------------------------------------: |
  |   GET   |          请求指定的页面信息，并返回主体          |
  |  POST   |                 提交数据到服务器                 |
  |  HEAD   |           主要用于获取报头，没有响应体           |
  |  TRACE  |     回显服务器收到的请求，主要用于诊断和测试     |
  | DELETE  |                   删除指定资源                   |
  |   PUT   |        向服务端发送数据取代指定的文档内容        |
  | OPTIONS |            运允许客户端查看服务器性能            |
  | CONNECT | HTTP/1.1中预留给能将连接改为管道方式的代理服务器 |

* 请求头

* 响应码

  |      |       类别       |            说明            |
  | :--: | :--------------: | :------------------------: |
  | 1xx  |   信息性状态码   |     接收的请求正在处理     |
  | 2xx  |    成功状态码    |      请求正常处理完毕      |
  | 3xx  |   重定向状态码   | 需要完成附加操作以完成请求 |
  | 4xx  | 客户端错误状态码 |     服务器无法处理请求     |
  | 5xx  | 服务端错误状态码 |     服务器处理请求出错     |

* 1.x

  `基于文本`

  > 1. 缓存处理。
  > 2. 断点续传。
  > 3. 错误通知。
  > 4. 错误通知。
  > 5. 长连接。
  >    1. 在一个TCP连接上可以传送多个HTTP请求和响应。
  >    2. Connection : keep-alive。
  >    3. HTTP/1.1 Pipeling，多个请求排队串行化单线程处理；线头阻塞，一旦前面超时，后面只能被阻塞。

* 2.0

  `基于二进制，分帧`

  > 1. 多路复用，连接共享。
  >    1. 多个请求在一个连接上并行执行，某个请求耗时时，不会影响到其他请求的执行。
  >    2. 每个请求都一个ID标识，客户端的ID是奇数，服务端的ID是偶数。
  > 2. header压缩。
  > 3. 服务器推送。

  > 拥有TCP的缺点。

* 3.0

  > 通过UDP替代TCP，继承了2.0的优点，解决了2.0的缺陷

  * QUIC

##### WebRTC

* Vioce Engine

* Video Engine

* SDP

* Transport

  * RTP
    * 实时传输协议
      * 多媒体电话
        * VoIP
        * 视频会议
        * 远程呈现系统
      * 多媒体流
        * 视频点播
        * 直播
      * 多媒体广播
    * 传输层，建立在UDP上。

  * Multiplexing
  * P2P
    * STUN
    * TURN
    * ICE
